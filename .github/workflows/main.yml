# -----------------------------------------------------------------
# GitHub Actions 配置文件
#
# 必须将此文件放置在您代码库的 .github/workflows/ 文件夹下
# 路径: .github/workflows/main.yml
# -----------------------------------------------------------------

name: '定时运行港股数据抓取'

on:
  # 1. 允许您在 GitHub 网站的 "Actions" 页面手动点击 "Run workflow" 来运行
  workflow_dispatch:
  
  # 2. 定时触发
  schedule:
    # 语法: 分 时 日 月 周 (UTC 时间)
    # '0 8 * * *' = 每天的 8:00 (UTC)，即北京时间 16:00
    - cron: '0 8 * * *'

jobs:
  run-yfinance-fetcher:
    # 使用最新的 Ubuntu 服务器环境
    runs-on: ubuntu-latest
    
    # 定义任务步骤
    steps:
      # 第一步: 检出 (Checkout) 你的代码
      # 这样 Runner 才能访问到你的 .py 脚本
      - name: '检出代码'
        uses: actions/checkout@v4

      # 第二步: 设置 Python 3.10 环境
      - name: '设置 Python 3.10'
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
          cache: 'pip' # 缓存依赖项，加快后续运行速度

      # 第三步: 安装 Python 依赖
      # 它会自动查找 requirements.txt 文件并安装
      - name: '安装依赖'
        run: pip install -r requirements.txt

      # 第四步: 运行你的 Python 脚本
      # 这是关键步骤
      - name: '运行 yfinance 抓取脚本'
        run: python yf251110.py

      # 第五步: 上传生成的 Excel 文件作为 "Artifact"
      # "Artifact" 是 GitHub Actions 中用于保存运行结果的术语
      - name: '上传 Excel 报告'
        uses: actions/upload-artifact@v4
        with:
          # (必须) Artifact 的名称
          name: Hk-Stock-Report 
          
          # (必须) 要上传的文件的路径
          # *.xlsx 是一个通配符，会匹配所有 .xlsx 结尾的文件
          path: ./*.xlsx
          
          # (可选) Artifact 的保存时间 (天)
          # 默认是 90 天，这里可以自定义
          retention-days: 30
